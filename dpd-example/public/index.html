<html>
<head>
    <title>Gym Central</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="bower_components/jqueryui/themes/base/all.css">
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/jqueryui/jquery-ui.min.js"></script>
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="bower_components/momentjs/min/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="bower_components/ejs_production/index.js"></script>
    <script type="text/javascript" src="dpd.js"></script>

    <script type="text/javascript" src="gstrap.js"></script>
</head>
<body style="margin-top:64px;">


<script type="text/javascript">

    new Gstrap({
        name:"my app",
        version:0.0,
        description:"description of your application",
        modules:[
            {
                name:"navbar",
                path:"modules/navbar/navbar.js"
            },
            {
                name:"default",
                path:"modules/default/default.js"
            },
            {
                name:"userProfile",
                path:"modules/user-profile/user-profile.js"
            },

            {
                name:"todo",
                path:"modules/todo/todo.js"
            }
        ],
        beforeLoad:function($g,next){
            // dpd authentication
            dpd.users.me(function(me) {
                $g.loggedUser=me;
                // run the rest if the user is or is not authenticated.
                next();
            });
        },
        load:function($g){

            // add the static modules. does not change on route change
            $g.static($g.modules.navbar({
                appName: "gsrap",
                navBarType:"navbar-inverse",
                navigation: [
                    {
                        name: "Home",
                        link: "#!/"
                    },
                    {
                        name: "ToDo",
                        link: "#!/todo/"
                    }
                ],
                loggedUser:$g.loggedUser //logged user object
            },$g));

            // place the dynamic modules.
            $g.dynamic();

            // listen to app level routes or override modules routes.
            $g.route('', function (req) {
                $g.page.html($g.modules.default());
            });

            // logout action. logout with dpd and reload the page
            $g.route('logout/', function (req) {
                dpd.users.logout(function(err) {
                    window.location.href='index.html';
                    if(err) console.log(err);
                });
            });

            $g.route('user-profile/',function(req){
                $g.modules.userProfile($g,$g.page);
            });

            // listen to routes on change.
            $g.listen();


        }

    });
</script>
</body>
</html>
